<html>
<head>
    <meta charset="utf-8">
    <title>交互式操作</title>
</head>

<style>
    .axis path,
    .axis line{
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }
    .dot {
        stroke: #000;
    }
    .tooltip {
        position: absolute;
        width: 200px;
        height: 28px;
        pointer-events: none;
    }
    .axis text {
        font-family: sans-serif;
        font-size: 11px;
    }


    .MyRect {

    }

    .MyText {
        fill: white;
        text-anchor: middle;
    }

</style>
<body>
<div >
    <P>Please choose yAxis</P>
    <label>
        <input type="checkbox" id="quality" name="quality" value="quality" />quality<br />
        <input type="checkbox" id="alcohol" name="alcohol" value="alcohol" />alcohol<br />
        <input type="checkbox" id="sulphates" name="sulphates" value="sulphates" />sulphates<br />
        <input type="checkbox" id="density" name="density" value="density" />density<br />
        <input type="checkbox" id="PH" name="PH" value="PH" />PH<br />
        <input type="checkbox" id="totalsulfurdioxide"name="total sulfur dioxide" value="total sulfur dioxide" />total sulfur dioxide<br />
        <input type="checkbox" id="freesulfurdioxide" name="free sulfur dioxide" value="free sulfur dioxide" />free sulfur dioxide<br />
        <input type="checkbox" id="chlorides" name="chlorides" value="chlorides" />chlorides<br />
        <input type="checkbox" id="residualsugar" name="residual sugar" value="residual sugar" />residual sugar<br />
        <input type="checkbox" id="citricacid" name="citric acid" value="citric acid" />citric acid<br />
        <input type="checkbox" id="volatileacidity" value="volatile acidity" />volatile acidity<br />
        <input type="checkbox" id="fixedacidity" name="fixed acidity" value="fixed acidity" />fixed acidity<br />

        </label>
    <P>Please choose xAxis</P>
    <label>
        <input type="checkbox" id="quality1" name="quality" value="quality" />quality<br />
        <input type="checkbox" id="alcohol1" name="alcohol" value="alcohol" />alcohol<br />
        <input type="checkbox" id="sulphates1" name="sulphates" value="sulphates" />sulphates<br />
        <input type="checkbox" id="density1" name="density" value="density" />density<br />
        <input type="checkbox" id="PH1" name="PH" value="PH" />PH<br />
        <input type="checkbox" id="totalsulfurdioxide1"name="total sulfur dioxide" value="total sulfur dioxide" />total sulfur dioxide<br />
        <input type="checkbox" id="freesulfurdioxide1" name="free sulfur dioxide" value="free sulfur dioxide" />free sulfur dioxide<br />
        <input type="checkbox" id="chlorides1" name="chlorides" value="chlorides" />chlorides<br />
        <input type="checkbox" id="residualsugar1" name="residual sugar" value="residual sugar" />residual sugar<br />
        <input type="checkbox" id="citricacid1" name="citric acid" value="citric acid" />citric acid<br />
        <input type="checkbox" id="volatileacidity1" value="volatile acidity" />volatile acidity<br />
        <input type="checkbox" id="fixedacidity1" name="fixed acidity" value="fixed acidity" />fixed acidity<br />

        <input type="button" id="checkbox" name="Simulation" value="Simulation" /><br />


    <iframe  id="myIframe" src="test5.html?xxx=fixed acidity&yyy=free sulfur dioxide" frameborder="0" scrolling="no" onload="resizeIframe(this)"></iframe>
    </label>
</div>


<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script>
    function resizeIframe(obj) {
        obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
        obj.style.width = obj.contentWindow.document.body.scrollWidth + 'px';
    }
    d3.csv("wine_red1.csv", function(error, data) {

        var dataset = [0,0,0,0,0,0,0,0,0,0];
        if(error) throw error;
        // change string (from CSV) into number format

        data.forEach(function(d) {
            if (d.quality == 0) {dataset[0]=++dataset[0];}
            if (d.quality == 1) {dataset[1]=++dataset[1];}
            if (d.quality == 2) {dataset[2]=++dataset[2];}
            if (d.quality == 3) {dataset[3]=++dataset[3];}
            if (d.quality == 4) {dataset[4]=++dataset[4];}
            if (d.quality == 5) {dataset[5]=++dataset[5];}
            if (d.quality == 6) {dataset[6]=++dataset[6];}
            if (d.quality == 7) {dataset[7]=++dataset[7];}
            if (d.quality == 8) {dataset[8]=++dataset[8];}
            if (d.quality == 9) {dataset[9]=++dataset[9];}

             d["fixed acidity"] = +d["fixed acidity"];
             d["free sulfur dioxide"]= +d["free sulfur dioxide"];
             d["quality"]= +d["quality"];
             d["sulphates"]= +d["sulphates"];
             d["alcohol"]= +d["alcohol"];
             d["density"]= +d["density"];
             d["total sulfur dioxide"]= +d["total sulfur dioxide"];
             d["PH"]= +d["PH"];
             d["chlorides"]= +d["chlorides"];
             d["citric acid"]= +d["citric acid"];
             d["residual sugar"]= +d["residual sugar"];
             d["citric acid"]= +d["citric acid"];
        //    console.log(d);
        });

        document.getElementById ("checkbox").addEventListener ("click",checkboxes,false);

        function checkboxes(id) {

            var xvalue;
            var yvalue;
            if (document.getElementById("quality").checked)
                yvalue = "quality";

            if (document.getElementById("alcohol").checked)
                yvalue = "alcohol";

            if (document.getElementById("sulphates").checked)
                yvalue = "sulphates";

            if (document.getElementById("density").checked)
                yvalue = "density";

            if (document.getElementById("PH").checked)
                yvalue = "PH";

            if (document.getElementById("totalsulfurdioxide").checked)
                yvalue = "total sulfur dioxide";

            if (document.getElementById("freesulfurdioxide").checked)
                yvalue = "free sulfur dioxide";

            if (document.getElementById("chlorides").checked)
                yvalue = "chlorides";

            if (document.getElementById("residualsugar").checked)
                yvalue = "residual sugar";

            if (document.getElementById("citricacid").checked)
                yvalue = "citric acid";


            if (document.getElementById("volatileacidity").checked)
                yvalue = "volatile acidity";

            if (document.getElementById("fixedacidity").checked)
                yvalue = "fixed acidity";

            if (document.getElementById("quality1").checked)
                xvalue = "quality";

            if (document.getElementById("alcohol1").checked)
                xvalue = "alcohol";

            if (document.getElementById("sulphates1").checked)
                xvalue = "sulphates";

            if (document.getElementById("density1").checked)
                xvalue = "density";

            if (document.getElementById("PH1").checked)
                xvalue = "PH";

            if (document.getElementById("totalsulfurdioxide1").checked)
                xvalue = "total sulfur dioxide";

            if (document.getElementById("freesulfurdioxide1").checked)
                xvalue = "free sulfur dioxide";

            if (document.getElementById("chlorides1").checked)
                xvalue = "chlorides";

            if (document.getElementById("residualsugar1").checked)
                xvalue = "residual sugar";

            if (document.getElementById("citricacid1").checked)
                xvalue = "citric acid";


            if (document.getElementById("volatileacidity1").checked)
                xvalue = "volatile acidity";

            if (document.getElementById("fixedacidity1").checked)
                xvalue = "fixed acidity";

            var sites = "test5.html?xxx="+xvalue+"&yyy="+yvalue;
            document.getElementById('myIframe').src = sites;

        }

        //画布大小
            var Barwidth = 400;
            var Barheight = 400;

            //在 body 里添加一个 SVG 画布
            var Barsvg = d3.select("body")
                    .append("svg")
                    .attr("width", Barwidth)
                    .attr("height", Barheight);
            //画布周边的空白
            var padding = {left: 30, right: 30, top: 20, bottom: 20};
            //x轴的比例尺
            var xScale = d3.scale.ordinal()
                    .domain(d3.range(dataset.length))
                    .rangeRoundBands([0, Barwidth - padding.left - padding.right]);

            //y轴的比例尺
            var yScale = d3.scale.linear()
                    .domain([0, d3.max(dataset)])
                    .range([Barheight - padding.top - padding.bottom, 0]);

            //定义x轴
            var xAxis = d3.svg.axis()
                    .scale(xScale)
                    .orient("bottom");

            //定义y轴
            var yAxis = d3.svg.axis()
                    .scale(yScale)
                    .orient("left");

            //矩形之间的空白
            var rectPadding = 4;

            //添加矩形元素
            var rects = Barsvg.selectAll(".MyRect")
                    .data(dataset)
                    .enter()
                    .append("rect")
                    .attr("class", "MyRect")
                    .attr("transform", "translate(" + padding.left + "," + padding.top + ")")
                    .attr("x", function (d, i) {
                        return xScale(i) + rectPadding / 2;
                    })
                    .attr("y", function (d) {
                        return yScale(d);
                    })
                    .attr("width", xScale.rangeBand() - rectPadding)
                    .attr("height", function (d) {
                        return Barheight - padding.top - padding.bottom - yScale(d);
                    })
                    .attr("fill", "steelblue")		//填充颜色不要写在CSS里
                    .on("mousedown", mousedown)
                    /*           function (d, i) {
                    d3.select(this)
                            .attr("fill", "yellow");
                })*/
                .on("mouseout", function (d, i) {
                    d3.select(this)
                            .transition()
                            .duration(500)
                            .attr("fill", "steelblue");
                });
        function mousedown(d, i) { d3.select(this)
                .attr("fill", "yellow");
        }
            //添加文字元素
        var texts = Barsvg.selectAll(".MyText")
                .data(dataset)
                .enter()
                .append("text")
                .attr("class", "MyText")
                .attr("transform", "translate(" + padding.left + "," + padding.top + ")")
                .attr("x", function (d, i) {
                    return xScale(i) + rectPadding / 2;
                })
                .attr("y", function (d) {
                    return yScale(d);
                })
                .attr("dx", function () {
                    return (xScale.rangeBand() - rectPadding) / 2;
                })
                .attr("dy", function (d) {
                    return 20;
                })
                .text(function (d) {
                    return d;
                });

        //添加x轴
        Barsvg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + padding.left + "," + (Barheight - padding.bottom) + ")")
                .call(xAxis);

        //添加y轴
        Barsvg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + padding.left + "," + padding.top + ")")
                .call(yAxis);

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /*    var margin = {top: 20, right: 20, bottom: 30, left: 40},
                Dotwidth = 960 - margin.left - margin.right,
                Dotheight = 500 - margin.top - margin.bottom;
        // setup x
        var DotxValue = function(d) { return d["fixed acidity"];}, // data -> value
                DotxScale = d3.scale.linear().range([0, Dotwidth]), // value -> display
                xMap = function(d) { return DotxScale(DotxValue(d));}, // data -> display
                DotxAxis = d3.svg.axis().scale(DotxScale).orient("bottom");

        // setup y
        var DotyValue = function(d) { return d["free sulfur dioxide"];}, // data -> value
                DotyScale = d3.scale.linear().range([Dotheight, 0]), // value -> display
                yMap = function(d) { return DotyScale(DotyValue(d));}, // data -> display
                DotyAxis = d3.svg.axis().scale(DotyScale).orient("left");

        // setup fill color
        var cValue = function(d) { return d.quality;},
                color = d3.scale.category10();

        // add the graph canvas to the body of the webpage
        var svg = d3.select("#chart").append("svg")
                .attr("width", Dotwidth + margin.left + margin.right)
                .attr("height", Dotheight + margin.top + margin.bottom)
                .append("g")
                //.attr("align","center")
                .attr("transform", "translate(" + margin.left + "," + margin.top +")");

        // add the tooltip area to the webpage
        var tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);


            // don't want dots overlapping axis, so add in buffer to data domain
//        DotxScale.domain([d3.min(data, DotxValue)-1, d3.max(data, DotxValue)+1]);
//        DotyScale.domain([d3.min(data, DotyValue)-1, d3.max(data, DotyValue)+1]);
        DotxScale.domain([(d3.min(data, function(d) {return d["fixed acidity"];})-1), (d3.max(data, function(d) {return d["fixed acidity"];})+1)]);
        DotyScale.domain([(d3.min(data, function(d) {return d["free sulfur dioxide"];})-1), (d3.max(data, function(d) {return d["free sulfur dioxide"];})+1)]);

            // x-axis
            svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + Dotheight + ")")
                    .call(DotxAxis)
                    .append("text")
                    .attr("class", "label")
                    .attr("x", Dotwidth)
                    .attr("y", -9)
                    .style("text-anchor", "end")
                    .text("fixed acidity");

            // y-axis
            svg.append("g")
                    .attr("class", "y axis")
                    .call(DotyAxis)
                    .append("text")
                    .attr("class", "label")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 9)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("free sulfur dioxide");

            // draw dots
            svg.selectAll(".dot")
                    .data(data)
                    .enter().append("circle")
                    .attr("class", "dot")
                    .attr("r", 3.5)
                    .attr("cx", xMap)
                    .attr("cy", yMap)
                    .style("fill", function(d) { return color(cValue(d));})
                    .on("mouseover", function(d) {
                        tooltip.transition()
                                .duration(200)
                                .style("opacity", .9);
                        tooltip.html(d["alcohol"] + "<br/> (" + DotxValue(d)
                                        + ", " + DotyValue(d) + ")")
                                .style("left", (d3.event.pageX + 5) + "px")
                                .style("top", (d3.event.pageY - 28) + "px");
                    })
                    .on("mouseout", function(d) {
                        tooltip.transition()
                                .duration(500)
                                .style("opacity", 0);
                    });

            // draw legend
            var legend = svg.selectAll(".legend")
                    .data(color.domain())
                    .enter().append("g")
                    .attr("class", "legend")
                    .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

            // draw legend colored rectangles
            legend.append("rect")
                    .attr("x", Dotwidth - 18)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", color);

            // draw legend text
            legend.append("text")
                    .attr("x", Dotwidth - 24)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .style("text-anchor", "end")
                    .text(function(d) { return d;})
*/

    });



</script>

</body>
</html>